<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Audit Tool</title>
    <style>
        :root {
            --brand-accent: #FF4438;
            --brand-accent-light: #FFE9E8;
            --brand-dark: #1E2022;
            --brand-soft: #52575D;
            --brand-bg: #FFF6F5;
            --brand-gradient: linear-gradient(90deg, #FF4438 0%, #FFB347 100%);
        }
        body {
            background: var(--brand-bg);
        }
        .audit-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
            color: var(--brand-dark);
        }
        .audit-form {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(255,68,56,0.05);
        }
        .url-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid var(--brand-accent-light);
            border-radius: 4px;
            font-size: 16px;
        }
        .submit-button {
            background: var(--brand-gradient);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(255,68,56,0.10);
            transition: background 0.2s, box-shadow 0.2s;
        }
        .submit-button:hover {
            background: linear-gradient(90deg, #E0352D 0%, #FFB347 100%);
            box-shadow: 0 4px 16px rgba(255,68,56,0.15);
        }
        .submit-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .results {
            display: none;
            margin-top: 20px;
        }
        .score-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        .score-card {
            background: var(--brand-accent-light);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(255,68,56,0.1);
            transition: all 0.3s ease;
            position: relative;
        }
        .highlight-card {
            background: var(--brand-gradient);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(255,68,56,0.2);
        }
        .score-description {
            font-size: 12px;
            margin-top: 8px;
            opacity: 0.8;
        }
        .highlight-card .score-description {
            color: rgba(255,255,255,0.9);
        }
        .score-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--brand-gradient);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.5s ease;
        }
        .score-card:hover::before {
            transform: scaleX(1);
        }
        .score-value {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
            position: relative;
            z-index: 2;
        }
        .score-value small {
            font-size: 14px;
            font-weight: normal;
            opacity: 0.8;
            display: block;
            margin-top: 5px;
        }
        .score-label {
            color: var(--brand-soft);
            font-size: 14px;
        }
        .issues-section {
            margin-top: 20px;
        }
        .issues-list {
            list-style: none;
            padding: 0;
        }
        .issue-item {
            background: #fff;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(255,68,56,0.07);
            border-left: 5px solid var(--brand-accent);
        }
        .issue-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--brand-accent);
        }
        .issue-description {
            color: var(--brand-soft);
            font-size: 14px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
            color: var(--brand-accent);
        }
        .error-message {
            color: #dc3545;
            margin-top: 10px;
            display: none;
        }
        .hero-section {
            background: #fff;
            padding: 40px 0 0 0;
        }
        .hero-content {
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 1200px;
            margin: 0 auto;
            gap: 0;
            position: relative;
        }
        .hero-left {
            flex: 1 1 50%;
            min-width: 340px;
            max-width: 540px;
            padding-left: 40px;
            z-index: 2;
        }
        .hero-right {
            flex: 1 1 50%;
            min-width: 340px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            position: relative;
        }
        .hero-image {
            max-width: 480px;
            width: 100%;
            border-radius: 0 0 0 0;
            object-fit: cover;
            box-shadow: none;
        }
        .play-button-overlay {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 3;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .play-circle {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(243,243,243,0.85);
            box-shadow: 0 2px 8px rgba(30,32,34,0.08);
        }
        .hero-eyebrow {
            color: var(--brand-accent);
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 18px;
        }
        .hero-title {
            font-size: 3.2rem;
            font-weight: 800;
            color: var(--brand-dark);
            margin: 0 0 18px 0;
            line-height: 1.1;
        }
        .hero-subtitle {
            color: var(--brand-soft);
            font-size: 1.2rem;
            margin-bottom: 32px;
            font-weight: 600;
        }
        .audit-form {
            margin-bottom: 0;
        }
        .submit-button {
            background: var(--brand-gradient);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.25rem;
            box-shadow: 0 2px 8px rgba(255,68,56,0.10);
            transition: background 0.2s, box-shadow 0.2s;
            margin-bottom: 0;
        }
        .submit-button:hover {
            background: linear-gradient(90deg, #E0352D 0%, #FFB347 100%);
            box-shadow: 0 4px 16px rgba(255,68,56,0.15);
        }
        @media (max-width: 900px) {
            .hero-content {
                flex-direction: column;
                gap: 0;
            }
            .hero-left, .hero-right {
                max-width: 100%;
                min-width: 0;
                padding-left: 0;
            }
            .play-button-overlay {
                left: 50%;
                top: auto;
                bottom: -40px;
                transform: translateX(-50%);
            }
        }
        @media (max-width: 600px) {
            .hero-section {
                padding: 20px 0 0 0;
            }
            .hero-title {
                font-size: 2rem;
            }
            .hero-image {
                max-width: 220px;
            }
            .play-circle {
                width: 56px;
                height: 56px;
            }
        }
        
        /* Added styles for SEO analysis results */
        .analysis-details {
            margin-top: 30px;
            padding: 0 20px 40px;
        }
        
        .score-explanations {
            margin-top: 30px;
            margin-bottom: 20px;
            padding: 0 20px;
        }
        
        .explanation {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .explanation h4 {
            margin-top: 0;
            color: var(--brand-accent);
            font-size: 18px;
        }
        
        .explanation ul {
            margin-bottom: 0;
            padding-left: 20px;
        }
        
        .category-section {
            margin-bottom: 30px;
            border-radius: 8px;
            padding: 20px;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .category-section h3 {
            margin-top: 0;
            color: var(--brand-accent);
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .category-score {
            background: var(--brand-gradient);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .recommendation-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .recommendation-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .recommendation-icon {
            min-width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .recommendation-icon.good {
            background-color: #4caf50;
            color: white;
        }
        
        .recommendation-icon.warning {
            background-color: #ff9800;
            color: white;
        }
        
        .recommendation-icon.bad {
            background-color: #f44336;
            color: white;
        }
        
        .recommendation-text {
            flex: 1;
        }
        
        .recommendation-title {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .analysis-details-raw {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .analysis-details-raw h4 {
            margin-top: 0;
            color: #444;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            margin-bottom: 15px;
        }
        
        .analysis-item {
            background: #fff;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(255,68,56,0.08);
            transition: all 0.3s ease;
        }
        .analysis-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(255,68,56,0.12);
        }
        .analysis-label {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--brand-dark);
        }
        .analysis-value {
            color: var(--brand-soft);
        }
        .good-indicator {
            color: #28a745;
        }
        .warning-indicator {
            color: #ffc107;
        }
        .bad-indicator {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="hero-section">
        <div class="hero-content">
            <div class="hero-left">
                <div class="hero-eyebrow">SEO Experts Committed to Your Success</div>
                <h1 class="hero-title">Leading SEO Agency<br>in the Philippines</h1>
                <div class="hero-subtitle">Bright Forge SEO helps businesses thrive online with focused strategies.</div>
                <form class="audit-form" id="auditForm">
                    <input type="url" id="urlInput" class="url-input" placeholder="Enter website URL (e.g., https://example.com)" required>
                    <button type="submit" id="submitButton" class="submit-button">Get Your Free SEO Audit</button>
                    <div id="errorMessage" class="error-message"></div>
                </form>
                <div id="loading" class="loading">Running audit... This may take a minute.</div>
            </div>
            <div class="hero-right">
                <img class="hero-image" src="https://brightforgeseo.com/wp-content/uploads/2025/03/ChatGPT-Image-Mar-27-2025-05_19_44-PM.webp" alt="Bright Forge SEO Hero" />
                <div class="play-button-overlay">
                    <div class="play-circle">
                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="24" cy="24" r="24" fill="#F3F3F3" fill-opacity="0.85"/>
                            <polygon points="20,16 34,24 20,32" fill="#FF4438"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
        <div id="results" class="results">
            <div class="score-grid">
                <div class="score-card">
                    <div class="score-label">On-page SEO Score</div>
                    <div id="onPageScore" class="score-value">-</div>
                    <div class="score-description">Title, Meta Tags, Headings, Internal Links</div>
                </div>
                <div class="score-card">
                    <div class="score-label">Technical SEO Score</div>
                    <div id="technicalScore" class="score-value">-</div>
                    <div class="score-description">HTTPS, Mobile, Performance, Structure</div>
                </div>
                <div class="score-card">
                    <div class="score-label">Content Score</div>
                    <div id="contentScore" class="score-value">-</div>
                    <div class="score-description">Images, Media, Text Optimization</div>
                </div>
                <div class="score-card highlight-card">
                    <div class="score-label">Overall SEO Score</div>
                    <div id="overallScore" class="score-value">-</div>
                    <div class="score-description">Comprehensive Assessment</div>
                </div>
            </div>
            <div class="score-explanations">
                <div class="explanation">
                    <h4>What do these scores mean?</h4>
                    <p>Our SEO Audit analyzes your website across three critical areas:</p>
                    <ul>
                        <li><strong>On-page SEO Score</strong> - Evaluates title, meta description, headings, and internal linking</li>
                        <li><strong>Technical SEO Score</strong> - Checks HTTPS, mobile-friendliness, performance, and technical elements</li>
                        <li><strong>Content Score</strong> - Assesses images, videos, text quality, and social sharing potential</li>
                    </ul>
                </div>
            </div>
            <div class="analysis-details" id="analysisDetails">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Using the local backend API URL for testing
        const API_URL = 'http://localhost:3000/api/analyze';

        document.getElementById('auditForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            
            const urlInput = document.getElementById('urlInput');
            const submitButton = document.getElementById('submitButton');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const errorMessage = document.getElementById('errorMessage');

            // Validate URL
            const url = urlInput.value.trim();
            if (!url || !url.startsWith('http')) {
                errorMessage.textContent = 'Please enter a valid website URL (starting with http:// or https://)';
                errorMessage.style.display = 'block';
                return;
            }

            // Reset UI
            errorMessage.style.display = 'none';
            results.style.display = 'none';
            loading.style.display = 'block';
            submitButton.disabled = true;

            try {
                console.log('Sending request to:', API_URL);
                console.log('With payload:', JSON.stringify({ url: url }));
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url }),
                    // Add these options to help with potential CORS issues
                    mode: 'cors',
                    credentials: 'omit'
                });

                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    try {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `Failed with status: ${response.status}`);
                    } catch (jsonError) {
                        throw new Error(`Request failed with status: ${response.status}`);
                    }
                }

                const data = await response.json();
                
                // Process data from our backend API
                if (data && data.analysis) {
                    const analysis = data.analysis;
                    // Process the SEO data
                    const titleElement = document.createElement('div');
                    titleElement.textContent = analysis.title || 'No title found';
                    
                    const descriptionElement = document.createElement('div');
                    descriptionElement.textContent = analysis.metaDescription || 'No meta description found';
                    
                    // Calculate title & meta description length
                    const titleLength = titleElement.textContent.length;
                    const metaDescLength = descriptionElement ? descriptionElement.textContent.length : 0;
                    
                    // Handle image alt text
                    const totalImages = analysis.imgCount || 0;
                    const imagesWithAlt = analysis.imgWithAltCount || 0;
                    const imgAltPercent = totalImages > 0 ? Math.round((imagesWithAlt / totalImages) * 100) : 0;
                    
                    console.log('Calculating comprehensive SEO scores...');
                    
                    // Additional data processing
                    const hasCanonical = analysis.canonicalUrl ? true : false;
                    const hasRobotsMeta = analysis.robotsMeta ? true : false;
                    const internalLinksCount = analysis.internalLinks || 0;
                    const externalLinksCount = analysis.externalLinks || 0;
                    const hasSSL = analysis.hasSSL || false;
                    const hasMobileViewport = analysis.hasMobileViewport || false;
                    const scriptCount = analysis.scriptCount || 0;
                    const stylesheetCount = analysis.cssCount || 0;
                    const socialMediaTags = analysis.socialMediaTags || 0;
                    
                    // Estimate text-to-code ratio and keyword density if not provided
                    const textToCodeRatio = analysis.textToCodeRatio || 0.3; // default estimate
                    const keywordDensity = analysis.keywordDensity || 1.5; // default estimate
                    
                    // Calculate individual metrics scores (0-100)
                    const titleScoreValue = calculateTitleScore(titleLength);
                    const metaScoreValue = calculateMetaScore(metaDescLength);
                    const h1ScoreValue = calculateH1Score(analysis.h1Count || 0);
                    const headingStructureScore = calculateHeadingStructureScore(analysis);
                    const internalLinkScore = calculateInternalLinkScore(internalLinksCount);
                    const externalLinkScore = calculateExternalLinkScore(externalLinksCount);
                    const imgAltScoreValue = calculateImgAltScore(imgAltPercent);
                    const sslScore = calculateSSLScore(hasSSL);
                    const mobileScore = calculateMobileScore(hasMobileViewport);
                    const performanceScore = calculatePerformanceScore(scriptCount, stylesheetCount);
                    const canonicalScore = calculateCanonicalScore(hasCanonical);
                    const robotsScore = calculateRobotsScore(hasRobotsMeta);
                    const socialMediaScore = calculateSocialMediaScore(analysis);
                    const contentLengthScore = calculateContentLengthScore(textToCodeRatio);
                    const keywordScore = calculateKeywordScore(keywordDensity);
                    const mediaScore = calculateMediaScore(totalImages, analysis.totalVideos || 0);
                    
                    // Log individual scores for debugging
                    console.log('Individual Scores:', {
                        title: titleScoreValue,
                        meta: metaScoreValue,
                        h1: h1ScoreValue,
                        headingStructure: headingStructureScore,
                        internalLinks: internalLinkScore,
                        externalLinks: externalLinkScore,
                        imgAlt: imgAltScoreValue,
                        ssl: sslScore,
                        mobile: mobileScore,
                        performance: performanceScore,
                        canonical: canonicalScore,
                        robots: robotsScore,
                        socialMedia: socialMediaScore,
                        contentLength: contentLengthScore,
                        keyword: keywordScore,
                        media: mediaScore
                    });
                    
                    // Calculate category scores
                    const onPageScore = calculateAverageScore([
                        titleScoreValue, 
                        metaScoreValue, 
                        h1ScoreValue, 
                        headingStructureScore,
                        internalLinkScore,
                        externalLinkScore
                    ]);
                    
                    const technicalScore = calculateAverageScore([
                        sslScore,
                        mobileScore,
                        performanceScore,
                        canonicalScore,
                        robotsScore
                    ]);
                    
                    const contentScore = calculateAverageScore([
                        imgAltScoreValue,
                        contentLengthScore,
                        keywordScore,
                        mediaScore,
                        socialMediaScore
                    ]);
                    
                    // Calculate overall score (weighted average)
                    const overallScore = Math.round(
                        (onPageScore * 0.4) + 
                        (technicalScore * 0.3) + 
                        (contentScore * 0.3)
                    );
                    
                    console.log('Category Scores:', {
                        onPage: onPageScore,
                        technical: technicalScore,
                        content: contentScore,
                        overall: overallScore
                    });

                    // Convert numeric scores to letter grades
                    const onPageGrade = getLetterGrade(onPageScore);
                    const technicalGrade = getLetterGrade(technicalScore);
                    const contentGrade = getLetterGrade(contentScore);
                    const overallGrade = getLetterGrade(overallScore);
                    
                    // Display category scores
                    document.getElementById('onPageScore').textContent = onPageGrade;
                    document.getElementById('technicalScore').textContent = technicalGrade;
                    document.getElementById('contentScore').textContent = contentGrade;
                    document.getElementById('overallScore').textContent = overallGrade;
                    
                    // Add percentage to score cards with small text
                    document.getElementById('onPageScore').innerHTML = `${onPageGrade} <small>${onPageScore}%</small>`;
                    document.getElementById('technicalScore').innerHTML = `${technicalGrade} <small>${technicalScore}%</small>`;
                    document.getElementById('contentScore').innerHTML = `${contentGrade} <small>${contentScore}%</small>`;
                    document.getElementById('overallScore').innerHTML = `${overallGrade} <small>${overallScore}%</small>`;
                    
                    // Populate analysis details with categorized recommendations
                    const analysisDetails = document.getElementById('analysisDetails');
                    
                    // Create On-Page SEO section with recommendations
                    let onPageRecommendations = '';
                    
                    // Title recommendations
                    if (titleScoreValue < 70) {
                        onPageRecommendations += createRecommendationItem(
                            'bad',
                            'Title needs improvement',
                            `Your title is ${titleLength} characters. ${getTitleRecommendation(titleLength)}`
                        );
                    } else {
                        onPageRecommendations += createRecommendationItem(
                            'good',
                            'Title length is optimal',
                            `Your title is ${titleLength} characters, which is within the recommended range.`
                        );
                    }
                    
                    // Meta description recommendations
                    if (metaScoreValue < 70) {
                        onPageRecommendations += createRecommendationItem(
                            'bad',
                            'Meta description needs improvement',
                            `Your meta description is ${metaDescLength} characters. ${getMetaRecommendation(metaDescLength)}`
                        );
                    } else if (analysis.metaDescription) {
                        onPageRecommendations += createRecommendationItem(
                            'good',
                            'Meta description is well-optimized',
                            `Your meta description is ${metaDescLength} characters, which is within the recommended range.`
                        );
                    } else {
                        onPageRecommendations += createRecommendationItem(
                            'bad',
                            'Missing meta description',
                            'Your page is missing a meta description. Add a compelling description between 120-155 characters.'
                        );
                    }
                    
                    // Heading structure recommendations
                    if (analysis.h1Count === 0) {
                        onPageRecommendations += createRecommendationItem(
                            'bad',
                            'Missing H1 heading',
                            'Your page is missing an H1 heading. Add a primary H1 heading that includes your main keyword.'
                        );
                    } else if (analysis.h1Count > 1) {
                        onPageRecommendations += createRecommendationItem(
                            'warning',
                            'Multiple H1 headings detected',
                            `Your page has ${analysis.h1Count} H1 headings. For optimal SEO, use only one H1 heading.`
                        );
                    } else {
                        onPageRecommendations += createRecommendationItem(
                            'good',
                            'H1 heading is well-optimized',
                            `Your page has 1 H1 heading: "${analysis.h1Text || 'Not readable'}"`
                        );
                    }
                    
                    // Link recommendations
                    if (internalLinkScore < 60) {
                        onPageRecommendations += createRecommendationItem(
                            'warning',
                            'Improve internal linking',
                            `Your page has ${internalLinksCount} internal links. Adding more internal links can improve site navigation and SEO.`
                        );
                    } else {
                        onPageRecommendations += createRecommendationItem(
                            'good',
                            'Good internal linking structure',
                            `Your page has ${internalLinksCount} internal links, which helps with website navigation and SEO.`
                        );
                    }
                    
                    // Generate Technical SEO recommendations
                    let technicalRecommendations = '';
                    
                    // SSL recommendations
                    if (!hasSSL) {
                        technicalRecommendations += createRecommendationItem(
                            'bad',
                            'SSL certificate missing',
                            'Your website does not use HTTPS. For security and SEO benefits, install an SSL certificate.'
                        );
                    } else {
                        technicalRecommendations += createRecommendationItem(
                            'good',
                            'SSL certificate installed',
                            'Your website correctly uses HTTPS, which is important for security and search rankings.'
                        );
                    }
                    
                    // Mobile viewport recommendations
                    if (!hasMobileViewport) {
                        technicalRecommendations += createRecommendationItem(
                            'bad',
                            'Mobile viewport not specified',
                            'Your page is missing a viewport meta tag, which is essential for mobile optimization.'
                        );
                    } else {
                        technicalRecommendations += createRecommendationItem(
                            'good',
                            'Mobile viewport is specified',
                            'Your page includes a viewport meta tag, which is good for mobile optimization.'
                        );
                    }
                    
                    // Canonical URL recommendations
                    if (!hasCanonical) {
                        technicalRecommendations += createRecommendationItem(
                            'warning',
                            'Missing canonical tag',
                            'Your page is missing a canonical tag, which helps prevent duplicate content issues.'
                        );
                    } else {
                        technicalRecommendations += createRecommendationItem(
                            'good',
                            'Canonical tag is present',
                            `Your page has a canonical URL specified: ${analysis.canonicalUrl}`
                        );
                    }
                    
                    // Performance recommendations
                    if (performanceScore < 70) {
                        technicalRecommendations += createRecommendationItem(
                            'warning',
                            'Performance optimization needed',
                            `Your page has ${scriptCount} script files and ${stylesheetCount} stylesheets. Consider minimizing and combining these resources.`
                        );
                    } else {
                        technicalRecommendations += createRecommendationItem(
                            'good',
                            'Good performance indicators',
                            'Your page appears to have reasonable performance indicators.'
                        );
                    }
                    
                    // Generate Content Score recommendations
                    let contentRecommendations = '';
                    
                    // Image alt text recommendations
                    const imgWithAltCount = analysis.imgWithAltCount || 0;
                    if (imgAltScoreValue < 70 && analysis.imgCount > 0) {
                        contentRecommendations += createRecommendationItem(
                            'warning',
                            'Image alt text needs improvement',
                            `Only ${imgWithAltCount} out of ${analysis.imgCount} images have alt text. Add descriptive alt text to all images.`
                        );
                    } else if (analysis.imgCount > 0) {
                        contentRecommendations += createRecommendationItem(
                            'good',
                            'Good image alt text usage',
                            `${imgWithAltCount} out of ${analysis.imgCount} images have alt text.`
                        );
                    }
                    
                    // Content length recommendations
                    if (contentLengthScore < 60) {
                        contentRecommendations += createRecommendationItem(
                            'warning',
                            'Content is too thin',
                            'Your page has a low text-to-code ratio. Adding more quality content can improve SEO performance.'
                        );
                    } else {
                        contentRecommendations += createRecommendationItem(
                            'good',
                            'Good content volume',
                            'Your page has a healthy amount of content with a good text-to-code ratio.'
                        );
                    }
                    
                    // Keyword density recommendations
                    if (keywordScore < 50) {
                        contentRecommendations += createRecommendationItem(
                            'warning',
                            'Keyword usage can be improved',
                            `Your keyword density is approximately ${analysis.keywordDensity ? analysis.keywordDensity.toFixed(1) : '0'}%. Consider optimizing your content with more relevant keywords.`
                        );
                    } else {
                        contentRecommendations += createRecommendationItem(
                            'good',
                            'Good keyword usage',
                            `Your keyword density is approximately ${analysis.keywordDensity ? analysis.keywordDensity.toFixed(1) : '0'}%, which is within a natural range.`
                        );
                    }
                    
                    // Social media recommendations
                    if (socialMediaScore < 50) {
                        contentRecommendations += createRecommendationItem(
                            'warning',
                            'Social media meta tags missing',
                            'Your page is missing OpenGraph and Twitter card tags, which help optimize social media sharing.'
                        );
                    } else {
                        contentRecommendations += createRecommendationItem(
                            'good',
                            'Social media tags present',
                            `Your page has ${analysis.socialMediaTags} social media tags, which helps with social sharing.`
                        );
                    }
                    
                    // Put it all together in categorized sections
                    analysisDetails.innerHTML = `
                        <div class="category-section">
                            <h3>On-page SEO <span class="category-score">${onPageGrade} (${onPageScore}%)</span></h3>
                            ${onPageRecommendations}
                        </div>
                        
                        <div class="category-section">
                            <h3>Technical SEO <span class="category-score">${technicalGrade} (${technicalScore}%)</span></h3>
                            ${technicalRecommendations}
                        </div>
                        
                        <div class="category-section">
                            <h3>Content Quality <span class="category-score">${contentGrade} (${contentScore}%)</span></h3>
                            ${contentRecommendations}
                        </div>
                        
                        <div class="analysis-details-raw">
                            <h4>Page Details</h4>
                            <div class="analysis-item">
                                <div class="analysis-label">Page Title</div>
                                <div class="analysis-value">${analysis.title || 'Not found'}</div>
                            </div>
                            <div class="analysis-item">
                                <div class="analysis-label">Meta Description</div>
                                <div class="analysis-value">${analysis.metaDescription || 'Not found'}</div>
                            </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Meta Keywords</div>
                            <div class="analysis-value">${analysis.keywordsMeta || 'Not found'}</div>
                            <div class="analysis-indicator ${analysis.keywordsMeta ? 'warning-indicator' : 'warning-indicator'}">
                                ${analysis.keywordsMeta ? 'Keywords meta is present but less important for modern SEO' : 'No keywords meta found (not critical for modern SEO)'}
                            </div>
                        </div>
                        
                        <h4>Page Structure</h4>
                        <div class="analysis-item">
                            <div class="analysis-label">Heading Structure</div>
                            <div class="analysis-value">
                                <strong>H1:</strong> ${analysis.h1Count} tag(s) ${analysis.h1Text ? `<small>(First H1: "${analysis.h1Text.substring(0, 50)}${analysis.h1Text.length > 50 ? '...' : ''}")</small>` : ''}<br>
                                <strong>H2:</strong> ${analysis.h2Count || 0} tag(s)<br>
                                <strong>H3:</strong> ${analysis.h3Count || 0} tag(s)<br>
                                <strong>H4-H6:</strong> ${((analysis.h4Count || 0) + (analysis.h5Count || 0) + (analysis.h6Count || 0))} tag(s)
                            </div>
                            <div class="analysis-indicator ${getH1IndicatorClass(analysis.h1Count)}">
                                ${getH1Recommendation(analysis.h1Count)}
                            </div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Images</div>
                            <div class="analysis-value">Found ${analysis.imgCount} images, ${analysis.imgWithAltCount} with alt text (${imgAltPercent}%)</div>
                            <div class="analysis-indicator ${getImgAltIndicatorClass(imgAltPercent)}">
                                ${getImgAltRecommendation(imgAltPercent)}
                            </div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Links</div>
                            <div class="analysis-value">
                                <strong>Internal Links:</strong> ${analysis.internalLinks}<br>
                                <strong>External Links:</strong> ${analysis.externalLinks}
                            </div>
                            <div class="analysis-indicator ${(analysis.internalLinks > 0) ? 'good-indicator' : 'warning-indicator'}">
                                ${getLinkRecommendation(analysis.internalLinks, analysis.externalLinks)}
                            </div>
                        </div>
                        
                        <h4>Technical SEO</h4>
                        <div class="analysis-item">
                            <div class="analysis-label">Canonical URL</div>
                            <div class="analysis-value">${analysis.canonicalUrl || 'Not found'}</div>
                            <div class="analysis-indicator ${analysis.canonicalUrl ? 'good-indicator' : 'bad-indicator'}">
                                ${analysis.canonicalUrl ? 'Good: Canonical URL is present' : 'Warning: No canonical URL found'}
                            </div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Robots Meta</div>
                            <div class="analysis-value">${analysis.robotsMeta || 'Not found'}</div>
                            <div class="analysis-indicator ${analysis.robotsMeta ? 'good-indicator' : 'warning-indicator'}">
                                ${analysis.robotsMeta ? 'Robots meta tag is present' : 'No robots meta tag found'}
                            </div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">SSL / HTTPS</div>
                            <div class="analysis-value">
                                ${analysis.hasSSL === true ? 'Secure HTTPS connection' : 'Insecure HTTP connection'}
                            </div>
                            <div class="analysis-indicator ${analysis.hasSSL === true ? 'good-indicator' : 'bad-indicator'}">
                                ${analysis.hasSSL === true ? 'Good: Site is using secure HTTPS connection' : 'Critical: Site is not using secure HTTPS connection'}
                            </div>
                        </div>
                        
                        <div class="analysis-item">
                            <div class="analysis-label">Mobile Friendliness</div>
                            <div class="analysis-value">
                                ${analysis.hasMobileViewport === true ? 'Mobile viewport meta tag found' : 'No mobile viewport meta tag found'}
                            </div>
                            <div class="analysis-indicator ${analysis.hasMobileViewport === true ? 'good-indicator' : 'bad-indicator'}">
                                ${analysis.hasMobileViewport === true ? 'Good: Page is configured for mobile devices' : 'Critical: Page is not configured for mobile devices'}
                            </div>
                        </div>
                        
                        <h4>Performance Indicators</h4>
                        <div class="analysis-item">
                            <div class="analysis-label">Page Resources</div>
                            <div class="analysis-value">
                                <strong>Scripts:</strong> ${analysis.scriptCount || 0}<br>
                                <strong>Stylesheets:</strong> ${analysis.cssCount || 0}<br>
                                <strong>Inline Styles:</strong> ${analysis.inlineStyles || 0}
                            </div>
                            <div class="analysis-indicator ${getPerformanceIndicatorClass(analysis.scriptCount || 0, analysis.cssCount || 0)}">
                                ${getPerformanceRecommendation(analysis.scriptCount || 0, analysis.cssCount || 0)}
                            </div>
                        </div>
                        
                        <h4>Social Media</h4>
                        <div class="analysis-item">
                            <div class="analysis-label">Social Media Tags</div>
                            <div class="analysis-value">
                                <strong>Open Graph Tags:</strong> ${analysis.openGraphTags || 0}<br>
                                <strong>Twitter Card Tags:</strong> ${analysis.twitterTags || 0}<br>
                                <strong>Total:</strong> ${analysis.socialMediaTags || 0}
                            </div>
                            <div class="analysis-indicator ${getSocialMediaIndicatorClass(analysis.socialMediaTags || 0)}">
                                ${getSocialMediaRecommendation(analysis.socialMediaTags || 0)}
                            </div>
                        </div>
                    `;
                    
                    results.style.display = 'block';
                } else {
                    throw new Error('Invalid response format from server');
                }
            } catch (error) {
                console.error('Error:', error);
                errorMessage.textContent = error.message || 'Failed to run audit. Please try again.';
                errorMessage.style.display = 'block';
            } finally {
                loading.style.display = 'none';
                submitButton.disabled = false;
            }
        });
        
        // Helper functions for scoring and recommendations
        // All scoring functions return a numeric score from 0-100
        
        // On-Page SEO scoring functions
        function calculateTitleScore(length) {
            if (length >= 30 && length <= 60) return 100;
            if ((length >= 20 && length < 30) || (length > 60 && length <= 70)) return 80;
            if ((length >= 10 && length < 20) || (length > 70 && length <= 80)) return 60;
            if (length > 0) return 30;
            return 0;
        }
        
        function calculateMetaScore(length) {
            if (length >= 120 && length <= 160) return 100;
            if ((length >= 100 && length < 120) || (length > 160 && length <= 180)) return 80;
            if ((length >= 80 && length < 100) || (length > 180 && length <= 200)) return 60;
            if (length > 0) return 30;
            return 0;
        }
        
        function calculateH1Score(count) {
            if (count === 1) return 100;
            if (count === 2) return 70;
            if (count > 2) return 40;
            return 0;
        }
        
        function calculateHeadingStructureScore(analysis) {
            // Check for proper heading hierarchy (h1, h2, h3, etc.)
            const h1 = analysis.h1Count || 0;
            const h2 = analysis.h2Count || 0;
            const h3 = analysis.h3Count || 0;
            
            // Ideal structure: 1 H1, some H2s, some H3s
            if (h1 === 1 && h2 >= 2 && h3 >= 1) return 100;
            if (h1 === 1 && h2 >= 1) return 80;
            if (h1 === 1) return 60;
            if (h1 > 1) return 40;
            return 0;
        }
        
        function calculateInternalLinkScore(count) {
            // Higher is better for internal linking
            if (count >= 10) return 100;
            if (count >= 7) return 90;
            if (count >= 5) return 80;
            if (count >= 3) return 60;
            if (count >= 1) return 40;
            return 0;
        }
        
        function calculateExternalLinkScore(count) {
            // Some external links are good for SEO
            if (count >= 3 && count <= 10) return 100;
            if (count > 10) return 80; // Too many might be excessive
            if (count >= 1) return 70;
            return 40; // No external links - not ideal but not terrible
        }
        
        // Technical SEO scoring functions
        function calculateSSLScore(hasSSL) {
            return hasSSL ? 100 : 0;
        }
        
        function calculateMobileScore(hasMobileViewport) {
            return hasMobileViewport ? 100 : 0;
        }
        
        function calculatePerformanceScore(scriptCount, stylesheetCount) {
            // Lower is better for performance (fewer scripts/stylesheets)
            const totalResources = (scriptCount || 0) + (stylesheetCount || 0);
            if (totalResources <= 10) return 100;
            if (totalResources <= 20) return 80;
            if (totalResources <= 30) return 60;
            if (totalResources <= 40) return 40;
            return 20;
        }
        
        function calculateCanonicalScore(hasCanonical) {
            return hasCanonical ? 100 : 0;
        }
        
        function calculateRobotsScore(hasRobotsMeta) {
            return hasRobotsMeta ? 100 : 40; // Not having robots is not ideal but not terrible
        }
        
        // Content scoring functions
        function calculateImgAltScore(percent) {
            return percent; // 0-100 already
        }
        
        function calculateContentLengthScore(textToCodeRatio) {
            // Higher text-to-code ratio is better
            if (textToCodeRatio >= 0.4) return 100;
            if (textToCodeRatio >= 0.3) return 80;
            if (textToCodeRatio >= 0.2) return 60;
            if (textToCodeRatio >= 0.1) return 40;
            return 20;
        }
        
        function calculateKeywordScore(density) {
            // Ideal keyword density is 1-3%
            if (density >= 1 && density <= 3) return 100;
            if (density > 3 && density <= 4) return 70; // Too high
            if (density > 0 && density < 1) return 70; // Too low
            if (density > 4) return 40; // Keyword stuffing
            return 20; // No keywords detected
        }
        
        function calculateMediaScore(imageCount, videoCount) {
            // Having media is good for engagement
            const totalMedia = (imageCount || 0) + (videoCount || 0);
            if (totalMedia >= 5) return 100;
            if (totalMedia >= 3) return 80;
            if (totalMedia >= 1) return 60;
            return 20;
        }
        
        function calculateSocialMediaScore(analysis) {
            // Check for open graph and twitter card tags
            const hasOG = (analysis.openGraphTags && analysis.openGraphTags > 0) ? true : false;
            const hasTwitter = (analysis.twitterCardTags && analysis.twitterCardTags > 0) ? true : false;
            
            if (hasOG && hasTwitter) return 100;
            if (hasOG || hasTwitter) return 70;
            return 0;
        }
        
        // Utility functions
        function calculateAverageScore(scores) {
            if (!scores || scores.length === 0) return 0;
            const sum = scores.reduce((total, score) => total + score, 0);
            return Math.round(sum / scores.length);
        }
        
        function getLetterGrade(score) {
            if (score >= 97) return 'A+';
            if (score >= 93) return 'A';
            if (score >= 90) return 'A-';
            if (score >= 87) return 'B+';
            if (score >= 83) return 'B';
            if (score >= 80) return 'B-';
            if (score >= 77) return 'C+';
            if (score >= 73) return 'C';
            if (score >= 70) return 'C-';
            if (score >= 67) return 'D+';
            if (score >= 63) return 'D';
            if (score >= 60) return 'D-';
            return 'F';
        }
            
            // Create HTML for a recommendation item
            function createRecommendationItem(status, title, description) {
                const icon = status === 'good' ? '' : (status === 'warning' ? '!': '');
                return `
                    <div class="recommendation-item">
                        <div class="recommendation-icon ${status}">${icon}</div>
                        <div class="recommendation-text">
                            <div class="recommendation-title">${title}</div>
                            <div>${description}</div>
                        </div>
                    </div>
                `;
            }
        
        function getTitleIndicatorClass(length) {
            if (length >= 30 && length <= 60) return 'good-indicator';
            if ((length >= 15 && length < 30) || (length > 60 && length <= 80)) return 'warning-indicator';
            return 'bad-indicator';
        }
        
        function getMetaIndicatorClass(length) {
            if (length >= 120 && length <= 160) return 'good-indicator';
            if ((length >= 80 && length < 120) || (length > 160 && length <= 200)) return 'warning-indicator';
            return 'bad-indicator';
        }
        
        function getH1IndicatorClass(count) {
            if (count === 1) return 'good-indicator';
            return 'warning-indicator';
        }
        
        function getImgAltIndicatorClass(percent) {
            if (percent >= 80) return 'good-indicator';
            if (percent >= 50) return 'warning-indicator';
            return 'bad-indicator';
        }
        
        function getTitleRecommendation(length) {
            if (length >= 30 && length <= 60) return '(Optimal)';
            if (length < 30) return '(Too short, should be 30-60 characters)';
            return '(Too long, should be 30-60 characters)';
        }
        
        function getMetaRecommendation(length) {
            if (length >= 120 && length <= 160) return '(Optimal)';
            if (length < 120) return '(Too short, should be 120-160 characters)';
            return '(Too long, should be 120-160 characters)';
        }
        
        function getH1Recommendation(count) {
            if (count === 1) return 'Good: Page has exactly one H1 tag';
            if (count === 0) return 'Warning: Page has no H1 tags';
            return 'Warning: Page has multiple H1 tags';
        }
        
        function getImgAltRecommendation(percent) {
            if (percent >= 80) return 'Good: Most images have alt text';
            if (percent >= 50) return 'Could improve: Add alt text to more images';
            return 'Poor: Many images missing alt text';
        }
        
        function getLinkRecommendation(internalLinks, externalLinks) {
            let recommendation = '';
            
            if (internalLinks < 3) {
                recommendation += 'Consider adding more internal links for better site navigation. ';
            } else {
                recommendation += 'Good number of internal links. ';
            }
            
            if (externalLinks < 1) {
                recommendation += 'Consider adding some outbound links to authoritative sources.';
            } else if (externalLinks > 20) {
                recommendation += 'Large number of external links - ensure they all add value.';
            } else {
                recommendation += 'Good balance of external links.';
            }
            
            return recommendation;
        }
        
        function getPerformanceIndicatorClass(scriptCount, cssCount) {
            const totalResources = scriptCount + cssCount;
            if (totalResources <= 15) return 'good-indicator';
            if (totalResources <= 30) return 'warning-indicator';
            return 'bad-indicator';
        }
        
        function getPerformanceRecommendation(scriptCount, cssCount) {
            const totalResources = scriptCount + cssCount;
            if (totalResources <= 15) {
                return 'Good: Page has a reasonable number of resources';
            } else if (totalResources <= 30) {
                return 'Consider optimizing: Page has a moderate number of resources';
            } else {
                return 'Needs improvement: Page has many resources which may impact load time';
            }
        }
        
        function getSocialMediaIndicatorClass(tagCount) {
            if (tagCount >= 6) return 'good-indicator';
            if (tagCount >= 1) return 'warning-indicator';
            return 'bad-indicator';
        }
        
        function getSocialMediaRecommendation(tagCount) {
            if (tagCount >= 6) {
                return 'Good: Page has comprehensive social media tags';
            } else if (tagCount >= 1) {
                return 'Consider adding more social media tags for better sharing';
            } else {
                return 'Missing social media tags - add Open Graph and Twitter Card tags';
            }
        }
    </script>
</body>
</html>
